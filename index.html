<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login - Equipe Alcateia</title>
<style>
  body { font-family: Arial, sans-serif; background: #0b0f14; color: #e5e7eb; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; }
  .container { background: #111827; padding:20px; border-radius:10px; width:320px; }
  select, input, button { width:100%; margin:8px 0; padding:10px; border-radius:8px; border:none; }
  button { background:#c7a24c; color:#020617; font-weight:600; cursor:pointer; }
  button:hover { background:#b29432; }
  .small { font-size:0.85rem; color:#9ca3af; cursor:pointer; text-align:center; margin-top:12px; }
</style>
</head>
<body>

<div class="container">
  <h2>Login Equipe Alcateia</h2>

  <select id="vendedoresSelect">
    <option value="">Selecione seu nome</option>
  </select>

  <input type="text" id="novoVendedor" placeholder="Novo vendedor (digite e clique em Adicionar)" autocomplete="off"/>

  <button id="btnAdicionar">Adicionar vendedor</button>
  <button id="btnEntrar">Entrar</button>

  <div id="msg" style="color:#ff6666; margin-top:10px;"></div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxkP2TGde192AW_4PGmRqDxB8JyNlU_tsEQqXl2pQCGNe6k3taOiiaDfJDY-8K29oNU2g/exec";

  const vendedoresSelect = document.getElementById("vendedoresSelect");
  const novoVendedorInput = document.getElementById("novoVendedor");
  const btnAdicionar = document.getElementById("btnAdicionar");
  const btnEntrar = document.getElementById("btnEntrar");
  const msg = document.getElementById("msg");

  async function carregarVendedores() {
    try {
      const res = await fetch(API_URL + "?acao=listarVendedores");
      const data = await res.json();
      vendedoresSelect.innerHTML = '<option value="">Selecione seu nome</option>';
      data.forEach(v => {
        const option = document.createElement("option");
        option.value = v;
        option.textContent = v;
        vendedoresSelect.appendChild(option);
      });
    } catch (e) {
      msg.textContent = "Erro ao carregar vendedores.";
    }
  }

  btnAdicionar.onclick = async () => {
    const nome = novoVendedorInput.value.trim();
    if (!nome) {
      msg.textContent = "Digite um nome para adicionar.";
      return;
    }
    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ acao: "adicionarVendedor", nome })
      });
      const json = await res.json();
      if (json.sucesso) {
        msg.style.color = "lightgreen";
        msg.textContent = "Vendedor adicionado!";
        novoVendedorInput.value = "";
        carregarVendedores();
      } else {
        msg.style.color = "red";
        msg.textContent = "Erro ao adicionar vendedor.";
      }
    } catch (e) {
      msg.textContent = "Erro na conexÃ£o.";
    }
  };

  btnEntrar.onclick = () => {
    const vendedor = vendedoresSelect.value;
    if (!vendedor) {
      msg.style.color = "red";
      msg.textContent = "Selecione seu nome para entrar.";
      return;
    }
    localStorage.setItem("vendedor", vendedor);
    window.location.href = "dashboard.html";
  };

  carregarVendedores();
</script>

</body>
</html>
